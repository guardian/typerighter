stacks:
- flexible
regions:
- eu-west-1
deployments:
  typerighter-checker:
    type: autoscaling
    dependencies:
    - typerighter-cloudformation
  typerighter-rule-manager:
    type: autoscaling
    dependencies:
    - typerighter-cloudformation
  upload-typerighter-live-content-lambda:
    type: aws-lambda
    app: typerighter-live-content-lambda
    contentDirectory: typerighter-live-content-lambda
    parameters:
      bucketSsmLookup: true
      lookupByTags: true
      fileName: typerighter-live-content-lambda.zip
    actions:
      - uploadLambda
  update-typerighter-live-content-lambda:
    type: aws-lambda
    app: typerighter-live-content-lambda
    contentDirectory: typerighter-live-content-lambda
    parameters:
      bucketSsmLookup: true
      lookupByTags: true
      fileName: typerighter-live-content-lambda.zip
    actions:
      - updateLambda
    dependencies:
      - typerighter-cloudformation
  typerighter-cloudformation:
    type: cloud-formation
    parameters:
      cloudFormationStackByTags: false
      cloudFormationStackName: typerighter
      prependStackToCloudFormationStackName: false
      amiParametersToTags:
        AMITyperighterchecker:
          Recipe: editorial-tools-focal-java11-ngrams-ARM-cdk-base
          BuiltBy: amigo
        AMITyperighterrulemanager:
          Recipe: editorial-tools-focal-java11-ARM-WITH-cdk-base
          BuiltBy: amigo
      amiEncrypted: true
      templateStagePaths:
        CODE: typerighter-CODE.template.json
        PROD: typerighter-PROD.template.json
    dependencies:
      - upload-typerighter-live-content-lambda
